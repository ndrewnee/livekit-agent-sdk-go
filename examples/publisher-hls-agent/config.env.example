# Publisher HLS Agent Configuration Example
# Copy this file to config.env and fill in your values:
#   cp config.env.example config.env
#   source config.env
#   ./publisher-hls-agent

# ============================================================================
# REQUIRED: LiveKit Server Connection
# ============================================================================

# LiveKit server WebSocket URL
# For production: wss://your-server.livekit.cloud
# For local development: ws://localhost:7880
export LIVEKIT_URL="ws://localhost:7880"

# LiveKit API credentials
# Get these from your LiveKit Cloud dashboard or generate them locally
export LIVEKIT_API_KEY="your-api-key"
export LIVEKIT_API_SECRET="your-api-secret"

# ============================================================================
# OPTIONAL: Agent Configuration
# ============================================================================

# Agent name used for job matching
# Default: publisher-hls-recorder
export AGENT_NAME="publisher-hls-recorder"

# Local output directory for recordings
# Recordings are saved to: OUTPUT_DIR/room-name/participant-identity/
# Default: publisher-hls-output
export OUTPUT_DIR="./recordings"

# Auto-activate recording when tracks are ready
# If true: Recording starts automatically when video+audio tracks subscribe
# If false: Call handler.ActivateRecording() programmatically
# Default: false
export AUTO_ACTIVATE_RECORDING="true"

# ============================================================================
# OPTIONAL: HLS Configuration
# ============================================================================

# HLS segment duration in seconds
# Smaller = lower latency, more segments
# Larger = higher latency, fewer segments
# Default: 2
export HLS_SEGMENT_DURATION="2"

# Maximum number of segments to keep in playlist
# 0 = unlimited (keeps all segments)
# N = keeps only last N segments (sliding window)
# Default: 0
export HLS_MAX_SEGMENTS="0"

# ============================================================================
# OPTIONAL: S3 Upload Configuration
# ============================================================================

# S3-compatible endpoint
# AWS S3: s3.amazonaws.com or s3.<region>.amazonaws.com
# MinIO: localhost:9000
# Leave empty to disable S3 upload
export S3_ENDPOINT=""

# S3 bucket name where recordings will be stored
export S3_BUCKET=""

# S3 region
# AWS regions: us-east-1, us-west-2, eu-west-1, etc.
# MinIO: can be any value (e.g., us-east-1)
# Default: us-east-1
export S3_REGION="us-east-1"

# S3 access credentials
export S3_ACCESS_KEY=""
export S3_SECRET_KEY=""

# Optional: STS session token for temporary credentials
export S3_SESSION_TOKEN=""

# S3 object key prefix (prepended to all uploaded files)
# Example: "recordings/" results in: s3://bucket/recordings/room/participant/...
# Default: empty (no prefix)
export S3_PREFIX="hls-recordings/"

# Use HTTPS for S3 connections
# true: Use https://
# false: Use http:// (for local MinIO)
# Default: false
export S3_USE_SSL="false"

# Use path-style S3 URLs
# true: http://endpoint/bucket/key (required for MinIO)
# false: http://bucket.endpoint/key (AWS virtual-hosted style)
# Default: true
export S3_FORCE_PATH_STYLE="true"

# S3 object ACL (canned ACL)
# Common values: private, public-read, public-read-write
# Leave empty for bucket default
# Default: empty
export S3_OBJECT_ACL=""

# ============================================================================
# Example Configurations
# ============================================================================

# Example 1: Local development (no S3)
# export LIVEKIT_URL="ws://localhost:7880"
# export LIVEKIT_API_KEY="devkey"
# export LIVEKIT_API_SECRET="secret"
# export AUTO_ACTIVATE_RECORDING="true"
# export OUTPUT_DIR="./recordings"

# Example 2: Production with AWS S3
# export LIVEKIT_URL="wss://your-server.livekit.cloud"
# export LIVEKIT_API_KEY="your-prod-key"
# export LIVEKIT_API_SECRET="your-prod-secret"
# export AUTO_ACTIVATE_RECORDING="true"
# export S3_ENDPOINT="s3.us-west-2.amazonaws.com"
# export S3_BUCKET="my-recordings"
# export S3_REGION="us-west-2"
# export S3_ACCESS_KEY="AKIAIOSFODNN7EXAMPLE"
# export S3_SECRET_KEY="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
# export S3_PREFIX="livekit/hls/"
# export S3_USE_SSL="true"
# export S3_FORCE_PATH_STYLE="false"

# Example 3: Local MinIO
# export LIVEKIT_URL="ws://localhost:7880"
# export LIVEKIT_API_KEY="devkey"
# export LIVEKIT_API_SECRET="secret"
# export AUTO_ACTIVATE_RECORDING="true"
# export S3_ENDPOINT="localhost:9000"
# export S3_BUCKET="recordings"
# export S3_REGION="us-east-1"
# export S3_ACCESS_KEY="minioadmin"
# export S3_SECRET_KEY="minioadmin"
# export S3_USE_SSL="false"
# export S3_FORCE_PATH_STYLE="true"
